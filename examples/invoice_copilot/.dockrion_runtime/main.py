"""
Dockrion Generated Runtime
==========================
Agent: invoice-serviceMode: Handler (direct callable)
Handler: app.service:process_invoiceDescription: Invoice processing service with custom handler logic.

Auto-generated by Dockrion SDK v1.0.0
Do not edit manually - regenerate using `dockrion build`
"""
import sys
import os
from pathlib import Path

# Add project root to Python path for agent module imports
# Use dockrion_common utility for consistent path resolution
from dockrion_common import setup_module_path

current_dir = Path(__file__).parent
module_path = "app.service:process_invoice"
# Setup Python path to find the agent module
project_root = setup_module_path(module_path, current_dir.parent)

from dockrion_runtime import create_app
from dockrion_schema import DockSpec

# Try to load .env from project root (if python-dotenv is available)
try:
    from dotenv import load_dotenv
    env_file = project_root / '.env'
    load_dotenv(env_file)
except ImportError:
    pass  # python-dotenv not installed, skip .env loading

# ============================================================================
# Agent Specification (Embedded from Dockfile.yaml)
# ============================================================================

SPEC_DATA = {'version': '1.0', 'agent': {'name': 'invoice-service', 'description': 'Invoice processing service with custom handler logic.', 'entrypoint': None, 'handler': 'app.service:process_invoice', 'framework': 'custom'}, 'io_schema': {'input': {'type': 'object', 'properties': {'document_text': {'type': 'string', 'description': 'Invoice text to process'}, 'currency_hint': {'type': 'string', 'description': 'Expected currency (INR, USD, EUR)'}, 'vendor_hint': {'type': 'string', 'description': 'Known vendor name'}, 'user_id': {'type': 'string', 'description': 'User ID for tracking'}}, 'required': ['document_text'], 'items': None, 'description': None}, 'output': {'type': 'object', 'properties': {'vendor': {'type': 'string'}, 'invoice_number': {'type': 'string'}, 'invoice_date': {'type': 'string'}, 'total_amount': {'type': 'number'}, 'currency': {'type': 'string'}, 'line_items': {'type': 'array', 'items': {'type': 'object', 'properties': {'description': {'type': 'string'}, 'quantity': {'type': 'number'}, 'unit_price': {'type': 'number'}, 'amount': {'type': 'number'}}}}, 'processing_metadata': {'type': 'object'}, 'success': {'type': 'boolean'}}, 'required': ['vendor', 'invoice_number', 'success'], 'items': None, 'description': None}}, 'arguments': {'timeout_sec': 30}, 'policies': None, 'auth': {'mode': 'api_key', 'api_keys': {'env_var': 'MY_AGENT_KEY', 'prefix': None, 'header': 'X-API-Key', 'allow_bearer': True, 'enabled': True, 'rotation_days': 30}, 'jwt': None, 'oauth2': None, 'roles': [], 'rate_limits': {}}, 'observability': None, 'expose': {'rest': True, 'streaming': 'none', 'port': 8080, 'host': '0.0.0.0', 'cors': {'origins': ['*'], 'methods': ['GET', 'POST', 'OPTIONS']}}, 'metadata': {'maintainer': 'Dockrion Team', 'version': 'v1.0.0', 'tags': ['handler-example', 'invoice', 'service']}, 'secrets': {'required': [{'name': 'MY_AGENT_KEY', 'description': 'API key for agent authentication', 'default': None}], 'optional': [{'name': 'LANGFUSE_SECRET', 'description': 'Langfuse telemetry', 'default': ''}]}}

# ============================================================================
# Create Application
# ============================================================================

# Parse and validate the embedded specification
spec = DockSpec.model_validate(SPEC_DATA)

# Create the FastAPI application using the runtime factory# Handler mode: direct callable function
app = create_app(
    spec=spec,
    agent_handler="app.service:process_invoice"
)
# ============================================================================
# Main Entry Point
# ============================================================================

if __name__ == "__main__":
    import uvicorn
    
    host = "0.0.0.0"
    port = 8080
    
    print(f"ðŸš€ Starting invoice-service on {host}:{port}")
    uvicorn.run(
        app,
        host=host,
        port=port,
        log_level="info"
    )
