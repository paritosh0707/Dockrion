"""
Dockrion Generated Runtime
==========================
Agent: invoice-copilotMode: Entrypoint (framework agent)
Framework: langgraph
Entrypoint: examples.invoice_copilot.app.graph:build_graphDescription: Extracts fields from invoices and returns a normalized JSON summary.

Auto-generated by Dockrion SDK v1.0.0
Do not edit manually - regenerate using `dockrion build`
"""
import sys
import os
from pathlib import Path

# Add project root to Python path for agent module imports
# Use dockrion_common utility for consistent path resolution
from dockrion_common import setup_module_path

current_dir = Path(__file__).parent
module_path = "examples.invoice_copilot.app.graph:build_graph"
# Setup Python path to find the agent module
project_root = setup_module_path(module_path, current_dir.parent)

from dockrion_runtime import create_app
from dockrion_schema import DockSpec

# Try to load .env from project root (if python-dotenv is available)
try:
    from dotenv import load_dotenv
    env_file = project_root / '.env'
    load_dotenv(env_file)
except ImportError:
    pass  # python-dotenv not installed, skip .env loading

# ============================================================================
# Agent Specification (Embedded from Dockfile.yaml)
# ============================================================================

SPEC_DATA = {'version': '1.0', 'agent': {'name': 'invoice-copilot', 'description': 'Extracts fields from invoices and returns a normalized JSON summary.', 'entrypoint': 'examples.invoice_copilot.app.graph:build_graph', 'handler': None, 'framework': 'langgraph'}, 'model': {'provider': 'openai', 'name': 'gpt-4o-mini', 'temperature': 0.2, 'max_tokens': 1500, 'endpoint': None, 'extra': {'response_format': 'json_object'}}, 'io_schema': {'input': {'type': 'object', 'properties': {'document_text': {'type': 'string'}, 'currency_hint': {'type': 'string', 'enum': ['INR', 'USD', 'EUR']}, 'vendor_hint': {'type': 'string'}}, 'required': ['document_text'], 'items': None, 'description': None}, 'output': {'type': 'object', 'properties': {'vendor': {'type': 'string'}, 'invoice_number': {'type': 'string'}, 'invoice_date': {'type': 'string'}, 'total_amount': {'type': 'number'}, 'currency': {'type': 'string'}, 'line_items': {'type': 'array', 'items': {'type': 'object', 'required': ['description', 'qty', 'unit_price', 'amount'], 'properties': {'description': {'type': 'string'}, 'qty': {'type': 'number'}, 'unit_price': {'type': 'number'}, 'amount': {'type': 'number'}}}}, 'notes': {'type': 'string'}}, 'required': ['vendor', 'invoice_number', 'invoice_date', 'line_items', 'total_amount'], 'items': None, 'description': None}}, 'arguments': {'timeout_sec': 20, 'enable_streaming': True}, 'policies': None, 'auth': {'mode': 'api_key', 'api_keys': {'env_var': 'DOCKRION_API_KEY', 'prefix': None, 'header': 'X-API-Key', 'allow_bearer': True, 'enabled': True, 'rotation_days': 30}, 'jwt': None, 'oauth2': None, 'roles': [{'name': 'admin', 'permissions': ['deploy', 'rollback', 'invoke', 'view_metrics', 'key_manage', 'read_logs', 'read_docs']}, {'name': 'developer', 'permissions': ['invoke', 'view_metrics', 'read_logs']}, {'name': 'viewer', 'permissions': ['invoke']}], 'rate_limits': {'admin': '1000/m', 'developer': '300/m', 'viewer': '60/m'}}, 'observability': None, 'expose': {'rest': True, 'streaming': 'sse', 'port': 8080, 'host': '0.0.0.0', 'cors': {'origins': ['http://localhost:3000', 'http://localhost:5173'], 'methods': ['GET', 'POST', 'OPTIONS']}}, 'metadata': {'maintainer': 'Paritosh <paritosh@example.com>', 'version': 'v1.0.0', 'tags': ['finance', 'extraction', 'demo']}, 'secrets': None}

# ============================================================================
# Create Application
# ============================================================================

# Parse and validate the embedded specification
spec = DockSpec.model_validate(SPEC_DATA)

# Create the FastAPI application using the runtime factory# Entrypoint mode: framework agent
app = create_app(
    spec=spec,
    agent_entrypoint="examples.invoice_copilot.app.graph:build_graph"
)
# ============================================================================
# Main Entry Point
# ============================================================================

if __name__ == "__main__":
    import uvicorn
    
    host = "0.0.0.0"
    port = 8080
    
    print(f"ðŸš€ Starting invoice-copilot on {host}:{port}")
    uvicorn.run(
        app,
        host=host,
        port=port,
        log_level="info"
    )
